"use strict";var _createClass=function(){function o(o,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}return function(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),t}}();function _classCallCheck(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}!function(o,t){t.module("wflAuthorization",["ngCookies"]),t.module("wflAuthorization").provider("wflAuthorization",function(){var o=this,n=this.defaults={connection:{url:"",method:"POST"},cookie:{key:"_authorizationUserData",expiresShort:new Date(Date.now()+864e5),expiresLong:new Date(Date.now()+6048e5),options:{}}};this.setOptions=function(o){return t.isObject(o)&&t.merge(n,o)},this.setCookieOptions=function(n){return t.isObject(n)&&o.setOptions({cookie:n})},this.setConnectionOptions=function(n){return t.isObject(n)&&o.setOptions({connection:n})},this.$get=["$cookies","$q","$http","$httpParamSerializerJQLike","$rootScope",function(o,e,i,r,u){var a={cookie:null,isAuthorized:!1,user:null};function s(){o.remove(n.cookie.key),a.cookie=null}function c(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.cookie.options;a.cookie=t.toJson(e),o.put(n.cookie.key,a.cookie,i)}function l(){return s(),a.user=null,a.isAuthorized=!1,a.user}return{login:function(o){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.cookie.options.expires=s?n.cookie.expiresLong:n.cookie.expiresShort;var h,f,d=t.merge({},n.connection,o);return(h=d,f=e.defer(),h.data=h.data?r(h.data):null,i(h).then(function(o){return f.resolve(o)},function(o){return f.reject(o)}),f.promise).then(function(t){var n;return n=o,a.user=n,a.isAuthorized=!0,c(n),u.$emit("wflAuthorization:login",a),t},function(o){return 401==o.status&&l(),o})},logout:function(){var o=e.defer();return null===l()?(o.resolve(a),u.$emit("wflAuthorization:logout",a)):o.reject(a),o.promise},onLogin:function(o,t){var n=u.$on("wflAuthorization:login",t);o.$on("$destroy",n)},onLogout:function(o,t){var n=u.$on("wflAuthorization:logout",t);o.$on("$destroy",n)},removeCookie:function(){s()},get data(){return a},get cookie(){return function(){a.cookie||void 0===o.get(n.cookie.key)||(a.cookie=o.getObject(n.cookie.key));return a.cookie}()},set cookie(o){c(o)},get user(){return a.user}}}]});var n=function(){function o(t){_classCallCheck(this,o),this.authorizationService=t,this.authorizationData=t.data}return _createClass(o,[{key:"signIn",value:function(){var o=this,t=btoa(this.username+":"+this.password);this.authorizationService.login({headers:{"X-PROXY-Authorization":"Basic "+t}}).then(function(){o.authorizationService.cookie=btoa(o.authorizationService.cookie)})}},{key:"signOut",value:function(){this.authorizationService.logout()}}]),o}();n.$inject=["wflAuthorization"],t.module("wflAuthorization").component("wflAuthorizationComponent",{controller:n,template:'\n  <div class="navbar-form navbar-right">\n  <form ng-submit="$ctrl.signIn()" ng-if="!$ctrl.authorizationData.isAuthorized">\n  <div class="form-group">\n  <input type="text" placeholder="username" class="form-control" ng-model="$ctrl.username" required="">\n  </div>\n  <div class="form-group">\n  <input type="password" placeholder="Password" class="form-control" ng-model="$ctrl.password" required="">\n  </div>\n  <button type="submit" class="btn btn-success">Sign in</button>\n  </form>\n  <button type="submit" class="btn btn-success" ng-click="$ctrl.signOut()" ng-if="$ctrl.authorizationData.isAuthorized">Sign out</button>\n  </div>\n  '})}(window,window.angular);